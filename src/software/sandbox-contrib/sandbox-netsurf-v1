#!/bin/execlineb -s0
# Launch netsurf with fewer permissions.
#
multisubstitute
{
	# DENY some /dev files.
	# Webcam access denial, via `/dev/video[0-9]*`, may need more entries.
	#
	define deny_dev /dev/snd:/dev/v4l:/dev/video0:/dev/video1

	# DENY portage files.
	#
	define deny_portage /etc/portage

	# DENY sensitive files.
	#
	define deny_private /boot:/mnt:${HOME}/Documents

	# DENY some /var files.
	#
	define deny_var /var/db:/var/lib:/var/log:/var/spool

	# WRITE cache files.
	#
	define write_cache ${XDG_CACHE_HOME}/netsurf:${XDG_CONFIG_HOME}/netsurf

	# WRITE download files.
	#
	define write_dl ${XDG_DOWNLOAD_DIR}

	# WRITE temporary files.
	#
	define write_tmpdir ${XDG_RUNTIME_DIR}/netsurf

	# WRITE window-management request.
	#
	define write_wm ${XDG_RUNTIME_DIR}/${WAYLAND_DISPLAY}

	# [BUG MITIGATION] WRITE .xbel file.
	#
	define write_xbel ${XDG_DATA_HOME}/recently-used.xbel
}

export SANDBOX_DENY  ${deny_dev}:${deny_portage}:${deny_private}:${deny_var}
export SANDBOX_WRITE ${write_dl}:${write_cache}:${write_tmpdir}:${write_wm}:${write_xbel}
export TMPDIR        ${write_tmpdir}

exec sandbox --
netsurf-gtk3 --block_advertisements 1 --disable_popups 1 --send_referer 0 ${@}
